# Анализ ER-диаграммы ER_Main.wsd

## Обзор

Диаграмма описывает модель данных для управления требованиями к программному обеспечению и архитектурой системы (версия 1.3.2). Модель следует стандарту ISO/IEC/IEEE 29148 для формулировки требований.

## Основные сущности

### 1. **projects** (Проекты)
**Назначение:** Контекст для всех артефактов системы

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `name` (TEXT) - название проекта
- `methodology` (TEXT, enum) - методология разработки
- `created_at` (TIMESTAMPTZ) - дата создания

**Связи:**
- Один проект содержит множество компонентов (1:N)

**Особенности:**
- Является корневой сущностью для группировки всех артефактов
- Определяет контекст: стандарты, сроки, участники

---

### 2. **requirements** (Требования)
**Назначение:** Атомарные формулировки требований по ISO/IEC/IEEE 29148

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `project_id` (UUID, FK) - связь с проектом
- `identifier` (TEXT, PK, unique) - уникальный идентификатор требования (например, REQ-001)
- `name` (TEXT, not null) - название требования
- `shall` (TEXT, not null) - формулировка требования (обязательное поле)
- `rationale` (TEXT, not null) - обоснование требования
- `verification_method` (TEXT, not null) - метод верификации
- `status` (TEXT, enum) - статус требования
- `version` (INT) - версия требования

**Связи:**
- Многие требования связаны с компонентами через `component_requirement_links` (N:M)

**Особенности:**
- Следует стандарту ISO/IEC/IEEE 29148
- Каждое требование имеет уникальный идентификатор
- Обязательные поля: name, shall, rationale, verification_method

---

### 3. **system_capabilities** (Функции системы)
**Назначение:** Логические возможности системы, группирующие требования

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `project_id` (UUID, FK) - связь с проектом
- `name` (TEXT, not null) - название функции
- `description` (TEXT) - описание
- `business_value` (TEXT) - бизнес-ценность
- `status` (TEXT, enum) - статус
- `version` (INT) - версия

**Связи:**
- Одна функция реализуется множеством компонентов (1:N)

**Особенности:**
- Высокоуровневая абстракция функциональности
- Связывает бизнес-ценность с технической реализацией

---

### 4. **ui_elements** (Элементы пользовательского интерфейса)
**Назначение:** Экраны, формы, поля с иерархией и прототипами

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `project_id` (UUID, FK) - связь с проектом
- `name` (TEXT, not null) - название элемента
- `type` (TEXT, enum) - тип элемента UI
- `description` (TEXT) - описание
- `capability_id` (UUID, FK) - связь с функцией системы
- `parent_id` (UUID, FK) - родительский элемент (иерархия)
- `status` (TEXT, enum) - статус
- `version` (INT) - версия

**Связи:**
- Многие UI элементы связаны с компонентами через `component_ui_links` (N:M)
- Иерархическая структура через `parent_id`

**Особенности:**
- Поддерживает иерархию элементов (например, форма → поля)
- Связан с функциями системы через `capability_id`

---

### 5. **system_components** (Системные компоненты)
**Назначение:** Реализации функций: сервисы, модули, БД, фронтенд

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `project_id` (UUID, FK) - связь с проектом
- `name` (TEXT, not null) - название компонента
- `type` (component_type, enum) - тип компонента
- `description` (TEXT) - описание
- `tech_stack` (TEXT[]) - технологический стек (массив)
- `parent_component_id` (UUID, FK) - родительский компонент
- `system_capability_id` (UUID, FK) - связь с функцией системы
- `status` (TEXT, enum) - статус
- `version` (TEXT) - версия
- `docs_url` (TEXT) - ссылка на документацию
- `source_code_url` (TEXT) - ссылка на исходный код

**Связи:**
- Один компонент может иметь множество зависимостей (1:N через `component_dependencies`)
- Один компонент связан с множеством требований (N:M через `component_requirement_links`)
- Один компонент связан с множеством UI элементов (N:M через `component_ui_links`)
- Иерархическая структура через `parent_component_id`
- Может иметь детали брокера сообщений (1:0..1 через `message_broker_details`)

**Типы компонентов (enum `component_type`):**
- `microservice` - микросервис
- `library` - библиотека
- `database` - база данных
- `api_gateway` - API Gateway
- `frontend_app` - фронтенд приложение
- `batch_job` - пакетная задача
- `event_handler` - обработчик событий
- `external_system` - внешняя система
- `message_broker` - брокер сообщений (Kafka, RabbitMQ, NATS)

**Особенности:**
- Центральная сущность архитектуры
- Поддерживает иерархию компонентов
- Содержит ссылки на документацию и исходный код

---

### 6. **component_dependencies** (Зависимости компонентов)
**Назначение:** Взаимодействия между компонентами: вызовы, события, чтение/запись данных

**Поля:**
- `id` (UUID, PK) - уникальный идентификатор
- `from_component_id` (UUID, FK) - исходный компонент
- `to_component_id` (UUID, FK) - целевой компонент
- `type` (dependency_type, enum) - тип зависимости
- `protocol` (TEXT) - протокол взаимодействия
- `interface` (TEXT) - интерфейс взаимодействия

**Типы зависимостей (enum `dependency_type`):**
- `calls` - вызовы
- `publishes` - публикация событий
- `subscribes` - подписка на события
- `reads` - чтение данных
- `writes` - запись данных
- `uses` - использование
- `deployed_with` - развертывание вместе

**Связи:**
- Многие зависимости от одного компонента (N:1)
- Многие зависимости к одному компоненту (N:1)

**Особенности:**
- Описывает направленные связи между компонентами
- Поддерживает различные типы взаимодействий

---

### 7. **component_requirement_links** (Реализация требований)
**Назначение:** Связь компонентов с требованиями - как компонент удовлетворяет требованию

**Поля:**
- `component_id` (UUID, FK, PK) - компонент
- `requirement_id` (UUID, FK, PK) - требование
- `implementation_detail` (TEXT) - детали реализации
- `coverage_level` (TEXT) - уровень покрытия

**Связи:**
- Многие компоненты к многим требованиям (N:M)

**Особенности:**
- Составной первичный ключ (component_id, requirement_id)
- Позволяет отслеживать трассировку требований

---

### 8. **component_ui_links** (Взаимодействие UI-компонент)
**Назначение:** Как интерфейс общается с бэкенд-компонентами

**Поля:**
- `component_id` (UUID, FK, PK) - компонент
- `ui_element_id` (UUID, FK, PK) - элемент UI
- `interaction` (TEXT) - описание взаимодействия

**Связи:**
- Многие компоненты к многим UI элементам (N:M)

**Особенности:**
- Составной первичный ключ (component_id, ui_element_id)
- Описывает взаимодействие между фронтендом и бэкендом

---

### 9. **message_broker_details** (Параметры брокера сообщений)
**Назначение:** Детали конфигурации брокеров сообщений (Kafka, RabbitMQ, NATS)

**Поля:**
- `component_id` (UUID, FK, PK) - компонент типа message_broker
- `broker_type` (TEXT, enum) - тип брокера
- `cluster_name` (TEXT) - название кластера
- `namespace` (TEXT) - пространство имен
- `topics` (JSONB) - топики (для Kafka)
- `queues` (JSONB) - очереди (для RabbitMQ)

**Связи:**
- Один компонент типа message_broker может иметь детали (1:0..1)

**Особенности:**
- Опциональная связь (только для компонентов типа message_broker)
- Использует JSONB для гибкого хранения топиков/очередей
- Версия 1.3.2 добавила явную поддержку брокеров сообщений

---

## Связи между сущностями

### Основные связи:

1. **projects → system_components** (1:N)
   - Один проект содержит множество компонентов

2. **system_capabilities → system_components** (1:N)
   - Одна функция реализуется множеством компонентов

3. **system_components → system_components** (1:N, иерархия)
   - Компоненты могут иметь родительские компоненты

4. **system_components → component_dependencies** (1:N)
   - Компонент имеет множество исходящих зависимостей

5. **component_dependencies → system_components** (N:1)
   - Зависимость указывает на целевой компонент

6. **system_components ↔ requirements** (N:M)
   - Через `component_requirement_links`
   - Компоненты реализуют требования

7. **system_components ↔ ui_elements** (N:M)
   - Через `component_ui_links`
   - Компоненты взаимодействуют с UI элементами

8. **system_components → message_broker_details** (1:0..1)
   - Компонент типа message_broker может иметь детали

---

## Ключевые особенности модели

### 1. **Трассировка требований**
- Прямая связь между требованиями и компонентами
- Отслеживание уровня покрытия требований
- Детали реализации требований

### 2. **Архитектурная модель**
- Иерархия компонентов
- Типизированные зависимости
- Поддержка различных типов компонентов

### 3. **UI-модель**
- Иерархия UI элементов
- Связь UI с компонентами
- Связь UI с функциями системы

### 4. **Брокеры сообщений**
- Явная поддержка брокеров сообщений (v1.3.2)
- Детальная конфигурация топиков и очередей
- Поддержка кластеров и пространств имен

### 5. **Версионирование**
- Большинство сущностей имеют поле `version`
- Поддержка истории изменений

---

## Рекомендации по реализации

### 1. **База данных**
- Использовать PostgreSQL (поддержка UUID, JSONB, TIMESTAMPTZ)
- Создать индексы на внешние ключи
- Использовать триггеры для автоматического версионирования

### 2. **Валидация**
- Проверка уникальности `identifier` в requirements
- Валидация enum значений
- Проверка целостности иерархий (parent_id)

### 3. **API**
- RESTful API для всех сущностей
- Поддержка фильтрации и поиска
- Версионирование API

### 4. **Бизнес-логика**
- Автоматическое создание `identifier` для требований
- Валидация связей между сущностями
- Проверка циклических зависимостей компонентов

---

## Примеры использования

### Пример 1: Создание требования
```
requirement {
  identifier: "REQ-001"
  name: "Аутентификация пользователя"
  shall: "Система должна аутентифицировать пользователя по email и паролю"
  rationale: "Обеспечение безопасности доступа"
  verification_method: "Тестирование"
  status: "draft"
}
```

### Пример 2: Связь компонента с требованием
```
component_requirement_links {
  component_id: "auth-service-uuid"
  requirement_id: "REQ-001-uuid"
  implementation_detail: "Реализовано через JWT токены"
  coverage_level: "full"
}
```

### Пример 3: Зависимость компонентов
```
component_dependencies {
  from_component_id: "auth-service-uuid"
  to_component_id: "kafka-cluster-uuid"
  type: "publishes"
  protocol: "Kafka"
  interface: "user.registered"
}
```

### Пример 4: Детали брокера сообщений
```
message_broker_details {
  component_id: "kafka-cluster-uuid"
  broker_type: "kafka"
  cluster_name: "production-cluster"
  namespace: "user-service"
  topics: {
    "user.registered": { partitions: 3, replication: 2 },
    "user.updated": { partitions: 3, replication: 2 }
  }
}
```

---

## Версия модели

**Текущая версия:** 1.3.2

**Изменения в v1.3.2:**
- Добавлена явная поддержка брокеров сообщений
- Добавлена сущность `message_broker_details`
- Добавлен тип `message_broker` в enum `component_type`

---

## Заключение

Модель данных представляет собой комплексную систему для управления требованиями и архитектурой ПО, поддерживающую:
- Стандартизированную формулировку требований (ISO/IEC/IEEE 29148)
- Детальное моделирование архитектуры системы
- Трассировку требований до компонентов
- Поддержку современных архитектурных паттернов (микросервисы, брокеры сообщений)
- Версионирование и историю изменений

