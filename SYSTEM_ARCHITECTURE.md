# Архитектура системы управления требованиями

## Обзор системы

Система управления требованиями к программному обеспечению состоит из 5 основных компонентов и единого пользовательского интерфейса.

## Компоненты системы

```
┌─────────────────────────────────────────────────────────────┐
│                    Единый UI (Frontend)                    │
│              React + Material-UI + React Router            │
└──────────────┬──────────────────────────────────────────────┘
               │
    ┌──────────┴──────────┐
    │   API Gateway        │
    │   (FastAPI Router)   │
    └──────────┬───────────┘
               │
    ┌──────────┴──────────────────────────────────────┐
    │                                                  │
┌───▼────────────┐  ┌───────────▼──────────┐  ┌──────▼──────────┐
│ Администратор │  │ Обработчик входящих  │  │ База знаний     │
│   проекта     │  │    требований        │  │ требований      │
│               │  │                      │  │                 │
│ + ИИ агент    │  │ + ИИ агент           │  │ + ИИ агент      │
└───┬───────────┘  └───────────┬──────────┘  └──────┬──────────┘
    │                          │                     │
    │                          │                     │
┌───▼──────────────────────────▼─────────────────────▼──────────┐
│              Хранилище требований (PostgreSQL)                │
│              На основе ER-диаграммы v1.4.1                    │
└────────────────────────────────────────────────────────────────┘
    │
    │
┌───▼───────────────────────────────────────────────────────────┐
│              Генератор спецификаций                            │
│              + ИИ агент                                        │
│              + Шаблоны (User Story, API, UML, C4)             │
└────────────────────────────────────────────────────────────────┘
```

## Детальное описание компонентов

### 1. Администратор проекта

**Назначение:** Управление проектами разработки систем

**Функции:**
- Создание нового проекта
- Настройка параметров проекта (методология, сроки, участники)
- Управление участниками проекта
- Связывание работы над требованиями с проектом
- Анализ состояния проекта

**ИИ агент:**
- Анализ параметров проекта и рекомендации
- Генерация структуры проекта на основе методологии
- Предложения по настройке workflow

**API Endpoints:**
- `POST /api/projects` - создание проекта
- `GET /api/projects` - список проектов
- `GET /api/projects/{id}` - детали проекта
- `PUT /api/projects/{id}` - обновление проекта
- `POST /api/projects/{id}/analyze` - ИИ анализ проекта

**База данных:**
- Таблица `projects` из ER-диаграммы

---

### 2. Обработчик входящих требований

**Назначение:** Автоматизированный анализ и формализация входящих требований

**Функции:**
- Прием неформализованных требований
- Анализ и структурирование требований
- Формализация в формат ISO/IEC/IEEE 29148
- Извлечение сущностей и связей
- Подготовка данных для Базы знаний

**ИИ агент:**
- Анализ неформализованного текста
- Извлечение структурированной информации
- Определение типа требования
- Выявление сущностей и зависимостей
- Формулировка критериев приемки

**API Endpoints:**
- `POST /api/requirements/process` - обработка входящего требования
- `GET /api/requirements/process/{id}` - статус обработки
- `POST /api/requirements/batch` - пакетная обработка

**Выходные данные:**
- Формализованное требование
- Связанные сущности
- Метаданные для Базы знаний

---

### 3. База знаний требований проекта

**Назначение:** Хранение требований в виде графа данных и их отношений

**Функции:**
- Импорт требований из Обработчика
- Хранение в графовой БД (Neo4j)
- Проверка на дубликаты
- Анализ противоречий
- Обновление векторного хранилища
- Генерация рекомендаций

**ИИ агент:**
- Семантический анализ требований
- Поиск дубликатов и похожих требований
- Выявление противоречий
- Генерация рекомендаций по дополнению/уточнению
- Анализ полноты требований

**Технологии:**
- Neo4j для графа данных
- Векторное хранилище (embeddings) для семантического поиска
- LangChain для работы с ИИ

**API Endpoints:**
- `POST /api/knowledge/import` - импорт требования
- `GET /api/knowledge/duplicates/{requirement_id}` - поиск дубликатов
- `GET /api/knowledge/conflicts/{requirement_id}` - анализ противоречий
- `GET /api/knowledge/recommendations/{requirement_id}` - рекомендации
- `GET /api/knowledge/graph` - визуализация графа

**Структура графа:**
- Узлы: Requirements, Entities, Components
- Связи: depends_on, conflicts_with, duplicates, related_to, involves

---

### 4. Хранилище требований

**Назначение:** Реляционное хранение всех данных о проекте и требованиях

**Функции:**
- Хранение проектов
- Хранение требований в формализованном виде
- Хранение компонентов системы
- Хранение UI элементов
- Хранение связей и зависимостей
- Хранение истории изменений
- Хранение комментариев и обсуждений

**Технологии:**
- PostgreSQL
- SQLAlchemy ORM
- Структура на основе ER-диаграммы v1.4.1

**API Endpoints:**
- CRUD операции для всех сущностей
- Поиск и фильтрация
- Экспорт данных

---

### 5. Генератор спецификаций

**Назначение:** Автоматизированная генерация спецификаций по требованиям

**Функции:**
- Генерация текстовых спецификаций (User Story, Use Case)
- Генерация контрактов (REST API, SOAP, gRPC, AsyncAPI)
- Генерация диаграмм (UML, C4)
- Управление шаблонами спецификаций
- Версионирование спецификаций

**ИИ агент:**
- Анализ требований для генерации спецификаций
- Адаптация шаблонов под контекст
- Генерация диаграмм в текстовом формате (PlantUML, Mermaid)

**Типы спецификаций:**

1. **Текстовые:**
   - User Story
   - Use Case
   - Техническая спецификация

2. **API контракты:**
   - OpenAPI/Swagger (REST)
   - WSDL (SOAP)
   - Protocol Buffers (gRPC)
   - AsyncAPI (Event-driven)

3. **Диаграммы:**
   - UML: Sequence, ER, Activity
   - C4: Context, Container, Component

**API Endpoints:**
- `POST /api/specs/generate` - генерация спецификации
- `GET /api/specs/templates` - список шаблонов
- `POST /api/specs/templates` - создание шаблона
- `GET /api/specs/{id}` - получение спецификации
- `GET /api/specs/{id}/export` - экспорт в различных форматах

**Хранилище шаблонов:**
- База данных для шаблонов
- Версионирование шаблонов
- Кастомизация шаблонов

---

## Потоки данных

### Поток 1: Создание проекта

```
UI → API Gateway → Администратор проекта → ИИ агент → Хранилище требований
```

### Поток 2: Обработка входящего требования

```
UI → API Gateway → Обработчик входящих требований → ИИ агент
    ↓
Формализованное требование → База знаний → ИИ агент (проверка дублей, противоречий)
    ↓
Хранилище требований (сохранение)
```

### Поток 3: Генерация спецификации

```
UI → API Gateway → Генератор спецификаций → ИИ агент
    ↓
Хранилище требований (чтение данных)
    ↓
База знаний (контекст)
    ↓
Генерация спецификации → Хранилище требований (сохранение)
```

---

## Технологический стек

### Backend
- **FastAPI** - API Gateway и микросервисы
- **PostgreSQL** - Хранилище требований
- **Neo4j** - База знаний (граф)
- **SQLAlchemy** - ORM
- **LangChain** - ИИ агенты
- **OpenAI/Anthropic** - LLM модели

### Frontend
- **React** - UI фреймворк
- **Material-UI** - Компоненты
- **React Router** - Маршрутизация
- **Axios** - HTTP клиент

### Векторное хранилище
- **pgvector** (PostgreSQL extension) или
- **ChromaDB** или
- **Qdrant**

### Генерация диаграмм
- **PlantUML** - UML диаграммы
- **Mermaid** - C4 и другие диаграммы
- **Graphviz** - Визуализация графов

---

## Структура проекта

```
analyst-assistant/
├── services/
│   ├── project_admin/          # Администратор проекта
│   │   ├── api.py
│   │   ├── ai_agent.py
│   │   └── models.py
│   ├── requirement_processor/   # Обработчик входящих требований
│   │   ├── api.py
│   │   ├── ai_agent.py
│   │   └── models.py
│   ├── knowledge_base/          # База знаний требований
│   │   ├── api.py
│   │   ├── ai_agent.py
│   │   ├── graph_rag.py
│   │   └── vector_store.py
│   ├── requirement_storage/     # Хранилище требований
│   │   ├── api.py
│   │   ├── models.py
│   │   └── database.py
│   └── spec_generator/          # Генератор спецификаций
│       ├── api.py
│       ├── ai_agent.py
│       ├── templates/
│       └── diagram_generators.py
├── frontend/                    # Единый UI
│   ├── src/
│   │   ├── pages/
│   │   │   ├── Projects/
│   │   │   ├── Requirements/
│   │   │   ├── KnowledgeBase/
│   │   │   └── Specifications/
│   │   └── components/
├── api_gateway/                 # API Gateway
│   └── main.py
├── shared/                      # Общие модули
│   ├── ai_config.py
│   ├── database.py
│   └── models.py
└── docker-compose.yml          # Оркестрация сервисов
```

---

## Интеграция компонентов

### События и сообщения

Компоненты взаимодействуют через:
- **Синхронные вызовы** (REST API)
- **Асинхронные события** (опционально, через message broker)

### Последовательность обработки требования

1. **Обработчик входящих требований** получает неформализованное требование
2. ИИ агент формализует требование
3. Данные отправляются в **Базу знаний**
4. ИИ агент Базы знаний проверяет дубликаты и противоречия
5. Обновляется векторное хранилище
6. Данные сохраняются в **Хранилище требований**
7. Генерируются рекомендации

### Генерация спецификации

1. Запрос на генерацию спецификации
2. **Генератор спецификаций** получает данные из **Хранилища требований**
3. **Генератор спецификаций** получает контекст из **Базы знаний**
4. ИИ агент анализирует требования и контекст
5. Применяется соответствующий шаблон
6. Генерируется спецификация
7. Сохранение в **Хранилище требований**

---

## Безопасность

- Аутентификация через JWT токены
- RBAC для контроля доступа
- Изоляция данных по проектам
- Аудит всех действий

---

## Масштабируемость

- Микросервисная архитектура
- Горизонтальное масштабирование компонентов
- Кэширование часто используемых данных
- Асинхронная обработка тяжелых операций

